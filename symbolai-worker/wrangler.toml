name = "symbolai-worker"
main = "./dist/_worker.js/index.js"
compatibility_date = "2025-01-15"
compatibility_flags = ["nodejs_compat"]

# Static Assets
[assets]
binding = "ASSETS"
directory = "./dist"

# Observability (Logging & Analytics)
[observability]
enabled = true

# D1 Database Binding
[[d1_databases]]
binding = "DB"
database_name = "symbolai-financial-db"
database_id = "3897ede2-ffc0-4fe8-8217-f9607c89bef2"

# KV Namespaces
# Sessions - User authentication and session management
[[kv_namespaces]]
binding = "SESSIONS"
id = "8f91016b728c4a289fdfdec425492aab"

# Cache - Application caching
[[kv_namespaces]]
binding = "CACHE"
id = "a497973607cf45bbbee76b64da9ac947"

# Files - File storage metadata
[[kv_namespaces]]
binding = "FILES"
id = "d9961a2085d44c669bbe6c175f3611c1"

# Rate Limiting - API rate limiting
[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "797b75482e6c4408bb40f6d72f2512af"

# OAuth - OAuth token storage
[[kv_namespaces]]
binding = "OAUTH_KV"
id = "57a4eb48d4f047e7aea6b4692e174894"

# R2 Bucket for Payroll PDFs
[[r2_buckets]]
binding = "PAYROLL_PDFS"
bucket_name = "symbolai-payrolls"

# Workflows Binding
[[workflows]]
binding = "WORKFLOWS"
name = "symbolai-workflows"
class_name = "FinancialWorkflow"

# D1 Database Migration Workflow
[[workflows]]
binding = "D1_MIGRATION_WORKFLOW"
name = "d1-migration-workflow"
class_name = "D1MigrationWorkflow"

# KV Batch Operations Workflow
[[workflows]]
binding = "KV_BATCH_WORKFLOW"
name = "kv-batch-workflow"
class_name = "KVBatchWorkflow"

# Cloudflare AI Binding
[ai]
binding = "AI"

# Cloudflare Agents (Durable Objects for MCP)
[[durable_objects.bindings]]
name = "CloudflareMCPAgent"
class_name = "CloudflareMCPAgent"
script_name = "symbolai-worker"

# Agent migrations (for Durable Objects)
[[migrations]]
tag = "v1"
new_classes = ["CloudflareMCPAgent"]

# Environment Variables / Secrets
[vars]
ENVIRONMENT = "production"
AI_GATEWAY_ACCOUNT_ID = "85b01d19439ca53d3cfa740d2621a2bd"
AI_GATEWAY_NAME = "default"

# Email Configuration
EMAIL_FROM = "info@symbolai.net"
EMAIL_FROM_NAME = "SymbolAI"
ADMIN_EMAIL = "admin@symbolai.net"

# Secrets (set using: wrangler secret put SECRET_NAME)
# ANTHROPIC_API_KEY
# RESEND_API_KEY (get from: https://resend.com/api-keys)
# RESEND_WEBHOOK_SECRET
# ZAPIER_WEBHOOK_URL
# SESSION_SECRET

# Routes configuration
routes = [
  { pattern = "symbolai.net/*", zone_name = "symbolai.net" },
  { pattern = "*.symbolai.net/*", zone_name = "symbolai.net" }
]

# Email Queue Configuration
[[queues.producers]]
queue = "email-queue"
binding = "EMAIL_QUEUE"

[[queues.consumers]]
queue = "email-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "email-dlq"

# Scheduled Tasks (Cron Triggers)
[triggers]
crons = [
  "0 2 * * *",      # Daily backup at 2 AM
  "0 9 25 * *",     # Payroll reminder on 25th at 9 AM
  "0 10 * * 6",     # Bonus reminder every Saturday at 10 AM
  "0 3 1 * *"       # Cleanup on 1st of month at 3 AM
]
